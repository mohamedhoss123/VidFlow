# RabbitMQ Configuration for VidFlow
# Security-hardened configuration based on best practices

# Disable guest user for security
loopback_users.guest = false

# Management plugin security configuration
management.tcp.port = 15672
management.tcp.ip = 0.0.0.0

# Security headers for management UI
management.hsts.policy = max-age=31536000; includeSubDomains
management.csp.policy = default-src 'self'; script-src 'self' 'unsafe-eval'
management.headers.content_type_options = nosniff
management.headers.xss_protection = 1; mode=block
management.headers.frame_options = DENY

# Disable basic auth for management HTTP API (use token-based auth)
management.disable_basic_auth = false

# HTTP access logging for security monitoring
management.http_log_dir = /var/log/rabbitmq

# Connection and resource limits
vm_memory_high_watermark.relative = 0.6
disk_free_limit.absolute = 2GB

# Network configuration
tcp_listen_options.backlog = 128
tcp_listen_options.nodelay = true
tcp_listen_options.keepalive = true

# Heartbeat configuration
heartbeat = 60

# Channel limits
channel_max = 2047

# Authentication and authorization
auth_mechanisms.1 = PLAIN
auth_mechanisms.2 = AMQPLAIN

# Logging configuration
log.console = true
log.console.level = info
log.file = /var/log/rabbitmq/rabbit.log
log.file.level = info
log.file.rotation.date = $D0
log.file.rotation.size = 10485760

# Cluster configuration (for future scaling)
cluster_formation.peer_discovery_backend = classic_config

# SSL/TLS configuration (commented out, can be enabled for production)
# ssl_options.cacertfile = /etc/rabbitmq/ssl/ca_certificate.pem
# ssl_options.certfile = /etc/rabbitmq/ssl/server_certificate.pem
# ssl_options.keyfile = /etc/rabbitmq/ssl/server_key.pem
# ssl_options.verify = verify_peer
# ssl_options.fail_if_no_peer_cert = true

# Management plugin rate limiting
management.rates_mode = basic

# Sample retention policies for management statistics
management.sample_retention_policies.global.minute = 5
management.sample_retention_policies.global.hour = 60
management.sample_retention_policies.global.day = 1200

management.sample_retention_policies.basic.minute = 5
management.sample_retention_policies.basic.hour = 60

management.sample_retention_policies.detailed.10 = 5
